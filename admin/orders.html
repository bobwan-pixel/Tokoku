<!DOCTYPE html><html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kelola Pesanan | Admin Tokoku</title>
  <link rel="stylesheet" href="../css/admin.css" />
</head>
<body>
  <div class="admin-container">
    <h1>Manajemen Pesanan</h1><table class="order-table">
  <thead>
    <tr>
      <th>ID</th>
      <th>Pembeli</th>
      <th>Total</th>
      <th>Status</th>
      <th>Aksi</th>
    </tr>
  </thead>
  <tbody id="orderTableBody">
    <!-- Daftar pesanan akan dimuat lewat JS -->
  </tbody>
</table>

  </div>  <script src="../js/orders.js"></script>  <script>
    document.addEventListener('DOMContentLoaded', function () {
      loadAllOrders();
    });

    function loadAllOrders() {
      const orders = JSON.parse(localStorage.getItem('tokoku_orders') || '[]');
      const tbody = document.getElementById('orderTableBody');
      tbody.innerHTML = '';

      orders.forEach((order, index) => {
        const tr = document.createElement('tr');

        tr.innerHTML = `
          <td>${order.id}</td>
          <td>${order.buyer}</td>
          <td>Rp ${order.total.toLocaleString()}</td>
          <td>
            <select data-index="${index}" class="status-dropdown">
              <option value="diproses" ${order.status === 'diproses' ? 'selected' : ''}>Diproses</option>
              <option value="dikirim" ${order.status === 'dikirim' ? 'selected' : ''}>Dikirim</option>
              <option value="selesai" ${order.status === 'selesai' ? 'selected' : ''}>Selesai</option>
            </select>
          </td>
          <td>
            <button class="cancel-btn" data-index="${index}">Batalkan</button>
          </td>
        `;

        tbody.appendChild(tr);
      });

      // Tambahkan event listener untuk dropdown dan tombol
      document.querySelectorAll('.status-dropdown').forEach(select => {
        select.addEventListener('change', updateOrderStatus);
      });

      document.querySelectorAll('.cancel-btn').forEach(button => {
        button.addEventListener('click', cancelOrder);
      });
    }

    function updateOrderStatus(e) {
      const index = e.target.dataset.index;
      const newStatus = e.target.value;
      const orders = JSON.parse(localStorage.getItem('tokoku_orders') || '[]');
      orders[index].status = newStatus;
      localStorage.setItem('tokoku_orders', JSON.stringify(orders));
      alert('Status pesanan diperbarui!');
    }

    function cancelOrder(e) {
      const index = e.target.dataset.index;
      if (confirm('Yakin ingin membatalkan pesanan ini?')) {
        const orders = JSON.parse(localStorage.getItem('tokoku_orders') || '[]');
        orders.splice(index, 1);
        localStorage.setItem('tokoku_orders', JSON.stringify(orders));
        loadAllOrders();
        alert('Pesanan berhasil dibatalkan.');
      }
    }
  </script></body>
</html>